<%- include('partials/header') %>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="Researchmember.css" />

<div class="container main-wrapper">
  <div class="hero-section">
    <div class="about-content">
      <h2>Our Research Group</h2>
      <p>
        Welcome to our research group page. We are dedicated to advancing
        knowledge in our field through collaborative research, innovation, and
        interdisciplinary approaches. Our diverse team consists of accomplished
        scholars, postgraduate students, undergraduate researchers, and alumni
        who continue to make significant contributions to the field.
      </p>
      <p>
        Explore our team members below and learn more about their research
        interests, achievements, and ongoing projects.
      </p>
    </div>
  </div>

  <div class="research-section">


    <!-- This div will be populated by JavaScript -->
    <div id="research-container">
      <!-- Loading indicator -->
      <div class="loading">
        <p>Loading research group data...</p>
      </div>
    </div>
  </div>
</div>
<!-- Properly closing main-wrapper -->
<%- include('partials/footer') %>

<script>
// Function to fetch and display research group data
async function loadResearchGroups() {
  try {
    const response = await fetch("/researchGroups");
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    const data = await response.json();

    const container = document.getElementById("research-container");
    container.innerHTML = "";

    // Categories in order
    const orderedCategories = [
      "Postdoctoral Researcher / Visiting Fellow",
      "Research Scholar",
      "Postgraduate",
      "Undergraduate",
      "Intern"
    ];

    // Functions to filter data
    const filterMembers = (status, type) => {
      return data.filter(m => 
        (m.status === status || (!m.status && status === 'Current')) && 
        m.type === type
      );
    };

    // 1. Research Team (Current)
    const researchTeamSection = createMainSection("Research Team");
    let hasResearchTeam = false;

    orderedCategories.forEach(category => {
      const members = filterMembers("Current", category);
      if (members.length > 0) {
        hasResearchTeam = true;
        const subSection = createSubSection(category, members);
        researchTeamSection.appendChild(subSection);
      }
    });

    if (hasResearchTeam) {
      container.appendChild(researchTeamSection);
    } else {
        const emptyMsg = document.createElement("p");
        emptyMsg.textContent = "No current research team members to display.";
        emptyMsg.className = "text-center text-gray-500 italic mt-4";
        researchTeamSection.appendChild(emptyMsg);
        container.appendChild(researchTeamSection);
    }

    // 2. Our Alumni
    const alumniSection = createMainSection("Our Alumni");
    let hasAlumni = false;

    orderedCategories.forEach(category => {
      const members = filterMembers("Alumni", category);
      if (members.length > 0) {
        hasAlumni = true;
        const subSection = createSubSection(category, members);
        alumniSection.appendChild(subSection);
      }
    });

    if (hasAlumni) {
      container.appendChild(alumniSection);
    }

  } catch (error) {
    console.error("Error loading research groups:", error);
    document.getElementById("research-container").innerHTML = `
      <div class="error-message"><p>Failed to load data. Please try again later.</p></div>`;
  }
}

function createMainSection(title) {
  const section = document.createElement("div");
  section.className = "main-group-section mb-10"; // Add spacing
  
  const heading = document.createElement("h1"); // Main header H1
  heading.className = "main-section-title text-3xl font-bold text-center mb-8 text-brand-primary";
  heading.textContent = title;
  
  // Custom styling for the header if needed (inline or class)
  heading.style.color = 'var(--primary-color, #0056b3)';
  heading.style.marginBottom = '1.5rem';
  heading.style.marginTop = '0';
  heading.style.borderBottom = '2px solid #eee';
  heading.style.paddingBottom = '0.5rem';

  section.appendChild(heading);
  return section;
}

function createSubSection(title, members) {
  const container = document.createElement("div");
  container.className = "sub-section mb-8";

  const heading = document.createElement("h2");
  heading.className = "sub-section-title text-xl font-semibold mb-4 pl-4 border-l-4 border-brand-secondary";
  heading.textContent = title;
  heading.style.fontSize = '1.5rem';
  heading.style.marginBottom = '1rem';
  heading.style.color = '#444';

  container.appendChild(heading);

  const cardsContainer = document.createElement("div");
  cardsContainer.className = "member-cards";
  
  members.forEach(member => {
    cardsContainer.appendChild(createMemberCard(member));
  });

  container.appendChild(cardsContainer);
  return container;
}

function createMemberCard(member) {
  const card = document.createElement("div");
  card.className = "member-card";

  const header = document.createElement("div");
  header.className = "member-header";
  
  const name = document.createElement("h4");
  name.textContent = member.name;
  header.appendChild(name);
  card.appendChild(header);

  const content = document.createElement("div");
  content.className = "member-content";

  const img = document.createElement("img");
  img.src = member.photoUrl;
  img.alt = member.name;
  img.className = "member-image";
  content.appendChild(img);

  const details = document.createElement("div");
  details.className = "member-details";

  details.innerHTML = `
    <p><span class="label">Position:</span> ${member.position || '-'}</p>
    ${member.scholarLink ? `<p><a href="${member.scholarLink}" target="_blank">Scholar Profile</a></p>` : ""}
    <p><span class="label">Topic:</span> ${member.scholarTopic || '-'}</p>
    <p><span class="label">Year:</span> ${member.year || '-'}</p>
  `;

  content.appendChild(details);
  card.appendChild(content);

  return card;
}

// Load research groups when DOM is ready
document.addEventListener("DOMContentLoaded", loadResearchGroups);

</script>

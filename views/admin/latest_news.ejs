<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Management - Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <style>
    /* Toggle switch styles */
    .toggle-btn {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-btn input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #3b82f6;
    }

    input:focus+.slider {
      box-shadow: 0 0 1px #3b82f6;
    }

    input:checked+.slider:before {
      transform: translateX(20px);
    }

    /* Animations and transitions */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }

    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* Moving bulletin preview */
    .bulletin-preview {
      background: linear-gradient(45deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .bulletin-content-preview {
      animation: marquee 15s linear infinite;
      white-space: nowrap;
    }

    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Image upload styles */
    .image-upload-area {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .image-upload-area:hover {
      border-color: #3b82f6;
      background-color: #f8fafc;
    }

    .image-upload-area.dragover {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
  </style>
</head>

<body class="bg-gray-100">
  <div class="flex h-screen overflow-hidden relative">
    <!-- Sidebar -->
  <aside id="sidebar"
      class="w-64 bg-blue-900 text-white shadow-lg transition-all duration-300 ease-in-out z-40 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 md:relative md:block">
      <div class="p-6 border-b border-blue-800">
        <h2 class="text-xl font-bold tracking-wide">
          Welcome, <%=adminID %>!
        </h2>
        <!-- Close button for mobile -->
        <button id="close-sidebar" class="absolute top-4 right-4 text-white md:hidden">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <nav class="mt-4">
        <ul>
          <li class="mb-1 px-2">
            <a href="/admin" class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-home mr-3"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="mb-1 px-2">
            <a href="/admin/control.html"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-sliders-h mr-3"></i>
              <span>Visibility Controls</span>
            </a>
          </li>
          <li class="mb-1 px-2">
            <a href="/admin/files.html"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-users mr-3"></i>
              <span>File Upload</span>
            </a>
          </li>
          <li class="mb-1 px-2">
            <a href="/admin/eResources.html"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-file-alt mr-3"></i>
              <span>e-Resources</span>
            </a>
          </li>
             <li class="mb-1 px-2">
            <a href="/admin/latest_news.html" class="flex items-center py-3 px-4 bg-blue-700 text-white rounded-md font-medium">
              <i class="fas fa-edit mr-3"></i>
              <span>Latest News & Scrolling</span>
            </a>
          </li>
          <li class="mb-1 px-2">
            <a href="/admin/formData"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-ticket-alt mr-3"></i>
              <span>User Requests</span>
            </a>
          </li>
          <li class="mb-1 px-2">
            <a href="/admin/cvGenerator.html"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-file-pdf mr-3"></i>
              <span>CV Generator</span>
            </a>
          </li>
          <br>
          <li style="padding-left: 13px; font-size: medium; font-size: 1.1rem;">Account</li>
          <li class="mb-1 px-2">
            <a href="/admin/logout"
              class="flex items-center py-3 px-4 text-blue-100 hover:bg-blue-800 rounded-md transition-all duration-200">
              <i class="fas fa-sign-out-alt mr-3"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto custom-scrollbar">
      <div class="p-4 md:p-6">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6 md:mb-8">
          <div class="flex items-center">
            <button id="mobile-menu-button" class="mr-3 text-gray-700 md:hidden">
              <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-xl md:text-2xl font-bold text-gray-800">
              Content Management
            </h1>
          </div>
          <div class="flex items-center space-x-2 md:space-x-4">
            <span class="text-gray-700 text-sm md:text-base hidden sm:inline">Welcome, Admin</span>
            <div class="w-8 h-8 md:w-10 md:h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-800 font-semibold">
              A
            </div>
          </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6">
          <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
              <button id="bulletin-tab" class="tab-button active py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-xl">
                <i class="fas fa-bullhorn mr-2"></i>
                Manage Bulletin 
              </button>
              <button id="carousel-tab" class="tab-button py-2 px-1 border-b-2 font-medium text-xl">
                <i class="fas fa-images mr-2"></i>
                Scrolling Section
              </button>
            </nav>
          </div>
        </div>

        <!-- Bulletin Management Tab -->
        <div id="bulletin-content" class="tab-content">
          <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover mb-6">
              <div class="bg-blue-800 text-white p-5">
                <h2 class="text-xl font-semibold flex items-center">
                  <i class="fas fa-bullhorn mr-3 text-2xl"></i>
                  Moving Bulletin Settings
                </h2>
                <p class="mt-1 text-blue-100 text-sm">
                  Manage the moving bulletin displayed at the top of your website
                </p>
              </div>
              
              <div class="p-6">
                <!-- Bulletin Toggle -->
                <div class="flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-lg">
                  <div>
                    <label for="bulletinEnabled" class="text-gray-800 font-medium text-lg block">Enable Bulletin</label>
                    <span class="text-gray-500 text-sm">Show/hide the bulletin on your website</span>
                  </div>
                  <label class="toggle-btn">
                    <input type="checkbox" id="bulletinEnabled" checked>
                    <span class="slider"></span>
                  </label>
                </div>

                <!-- Bulletin Form -->
                <form id="bulletin-form" class="space-y-6">
                  <input type="hidden" id="bulletinId" value="">
                  <div class="grid md:grid-cols-2 gap-6">
                    <div>
                      <label for="bulletinTitle" class="block text-sm font-medium text-gray-700 mb-2">
                        Bulletin Title
                      </label>
                      <input type="text" id="bulletinTitle" name="title" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="e.g., Latest News, Announcement" value="Latest News :">
                    </div>
                    
                    <div>
                      <label for="bulletinPriority" class="block text-sm font-medium text-gray-700 mb-2">
                        Priority Level
                      </label>
                      <select id="bulletinPriority" name="priority" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="bulletinMessage" class="block text-sm font-medium text-gray-700 mb-2">
                      Bulletin Message
                    </label>
                    <textarea id="bulletinMessage" name="message" rows="3" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Enter your bulletin message here...">GOBAiR receives the Best Product Award in Rural Innovators Conclave 2025</textarea>
                  </div>

                  <div class="grid md:grid-cols-2 gap-6">
                    <div>
                      <label for="bulletinLink" class="block text-sm font-medium text-gray-700 mb-2">
                        Optional Link
                      </label>
                      <input type="url" id="bulletinLink" name="linkUrl"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="https://example.com/article" />
                    </div>
                    <div>
                      <label for="bulletinSpeed" class="block text-sm font-medium text-gray-700 mb-2">
                        Animation Speed (seconds)
                      </label>
                      <input type="number" id="bulletinSpeed" name="speed" min="5" max="30" value="15"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                      <label for="bulletinColor" class="block text-sm font-medium text-gray-700 mb-2">
                        Background Color
                      </label>
                      <select id="bulletinColor" name="color" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="blue">Blue</option>
                        <option value="red">Red (Urgent)</option>
                        <option value="green">Green (Success)</option>
                        <option value="orange">Orange (Warning)</option>
                        <option value="purple">Purple</option>
                      </select>
                    </div>
                  </div>

                  <!-- Bulletin Preview -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
                    <div id="bulletin-preview" class="bulletin-preview">
                      <div class="bulletin-content-preview">
                        <strong>Latest News :</strong> GOBAiR receives the Best Product Award in Rural Innovators Conclave 2025
                      </div>
                    </div>
                  </div>

                  <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-save mr-2"></i>
                    Save Bulletin
                  </button>
                  <button type="button" id="resetBulletinBtn" class="w-full mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors">
                    Reset Form
                  </button>
                </form>

                <div class="mt-8">
                  <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                      <i class="fas fa-list"></i> Bulletins
                    </h3>
                    <span class="text-sm text-gray-500" id="bulletinCount">0 items</span>
                  </div>
                  <div id="bulletinList" class="space-y-3">
                    <div class="text-gray-500 text-sm">No bulletins yet.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Carousel Management Tab -->
        <div id="carousel-content" class="tab-content hidden">
          <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover mb-6">
              <div class="bg-blue-800 text-white p-5">
                <h2 class="text-xl font-semibold flex items-center">
                  <i class="fas fa-images mr-3 text-2xl"></i>
                  Carousel Content Management
                </h2>
                <p class="mt-1 text-purple-100 text-sm">
                  Manage slides in your achievements & recognition carousel
                </p>
              </div>
              
              <div class="p-6">
                <!-- Add New Slide Button -->
                <div class="mb-6">
                  <button id="add-slide-btn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    Add New Slide
                  </button>
                </div>

                <!-- Carousel Slides List -->
                <div id="slides-container" class="space-y-4">
                  <!-- Slides will be populated here -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Status Messages -->
        <div id="status-message" class="fixed bottom-4 right-4 p-4 rounded-lg shadow-lg hidden z-50"></div>
      </div>
    </main>
  </div>

  <!-- Add/Edit Slide Modal -->
  <div id="slide-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
      <div class="p-6 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <h3 id="modal-title" class="text-lg font-semibold">Add New Slide</h3>
          <button id="close-modal" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <form id="slide-form" class="p-6 space-y-6">
        <input type="hidden" id="slide-id" name="id">
        
        <div>
          <label for="slide-title" class="block text-sm font-medium text-gray-700 mb-2">
            Slide Title
          </label>
          <input type="text" id="slide-title" name="title" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
            placeholder="e.g., Research Publication, Award">
        </div>

        <div>
          <label for="slide-description" class="block text-sm font-medium text-gray-700 mb-2">
            Description
          </label>
          <textarea id="slide-description" name="description" rows="3" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
            placeholder="Brief description of the achievement"></textarea>
        </div>

        <div>
          <label for="slide-image" class="block text-sm font-medium text-gray-700 mb-2">
            Image Upload
          </label>
          <div class="image-upload-area p-6 text-center cursor-pointer" id="image-upload">
            <div id="upload-placeholder">
              <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
              <p class="text-gray-600">Click to upload or drag and drop</p>
              <p class="text-sm text-gray-400">PNG, JPG, GIF up to 5MB</p>
            </div>
            <div id="image-preview" class="hidden">
              <img id="preview-img" src="" alt="Preview" class="max-w-full h-32 mx-auto rounded">
              <p id="image-name" class="text-sm text-gray-600 mt-2"></p>
            </div>
          </div>
          <input type="file" id="slide-image" name="image" accept="image/*" class="hidden">
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label for="slide-order" class="block text-sm font-medium text-gray-700 mb-2">
              Display Order
            </label>
            <input type="number" id="slide-order" name="order" min="1" value="1"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
          </div>
          
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div>
              <label for="slide-active" class="text-gray-800 font-medium block">Active</label>
              <span class="text-gray-500 text-sm">Show this slide</span>
            </div>
            <label class="toggle-btn">
              <input type="checkbox" id="slide-active" name="active" checked>
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="flex space-x-4 pt-4 border-t border-gray-200">
          <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
            <i class="fas fa-save mr-2"></i>
            Save Slide
          </button>
          <button type="button" id="cancel-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
   // Updated JavaScript for latest_news.html - Handles file uploads properly

// Global variables
let slides = [];
let editingSlideId = null;
let bulletins = [];
let editingBulletinId = null;

document.addEventListener('DOMContentLoaded', function () {
  initializeApp();
});

function initializeApp() {
  setupSidebar();
  setupTabs();
  setupBulletinForm();
  setupCarouselManagement();
  loadInitialData();
}

// Sidebar functionality
function setupSidebar() {
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const closeSidebarButton = document.getElementById("close-sidebar");
  const sidebar = document.getElementById("sidebar");
  const sidebarOverlay = document.getElementById("sidebar-overlay");

  function openSidebar() {
    sidebar.classList.remove("-translate-x-full");
    sidebarOverlay.classList.remove("hidden");
    document.body.classList.add("overflow-hidden");
  }

  function closeSidebar() {
    sidebar.classList.add("-translate-x-full");
    sidebarOverlay.classList.add("hidden");
    document.body.classList.remove("overflow-hidden");
  }

  mobileMenuButton?.addEventListener("click", openSidebar);
  closeSidebarButton?.addEventListener("click", closeSidebar);
  sidebarOverlay?.addEventListener("click", closeSidebar);

  window.addEventListener("resize", () => {
    if (window.innerWidth >= 768) {
      sidebar.classList.remove("-translate-x-full");
      sidebarOverlay.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    } else {
      sidebar.classList.add("-translate-x-full");
    }
  });
}

// Tab functionality
function setupTabs() {
  const bulletinTab = document.getElementById('bulletin-tab');
  const carouselTab = document.getElementById('carousel-tab');
  const bulletinContent = document.getElementById('bulletin-content');
  const carouselContent = document.getElementById('carousel-content');

  bulletinTab.addEventListener('click', () => {
    switchTab('bulletin');
  });

  carouselTab.addEventListener('click', () => {
    switchTab('carousel');
  });

  function switchTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
      btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
    });

    // Hide all content
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.add('hidden');
    });

    if (tab === 'bulletin') {
      bulletinTab.classList.add('active', 'border-blue-500', 'text-blue-600');
      bulletinTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
      bulletinContent.classList.remove('hidden');
    } else {
      carouselTab.classList.add('active', 'border-blue-500', 'text-blue-600');
      carouselTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
      carouselContent.classList.remove('hidden');
    }
  }
}
// Bulletin form functionality
function setupBulletinForm() {
  const form = document.getElementById('bulletin-form');
  const titleInput = document.getElementById('bulletinTitle');
  const messageInput = document.getElementById('bulletinMessage');
  const speedInput = document.getElementById('bulletinSpeed');
  const colorSelect = document.getElementById('bulletinColor');
  const preview = document.getElementById('bulletin-preview');
  const resetBtn = document.getElementById('resetBulletinBtn');

  function updateBulletinPreview() {
    const title = titleInput.value || 'Latest News :';
    const message = messageInput.value || 'Your bulletin message will appear here';
    const speed = speedInput.value || 15;
    const color = colorSelect.value || 'blue';

    const colorClasses = {
      blue: 'bg-gradient-to-r from-blue-600 to-blue-800',
      red: 'bg-gradient-to-r from-red-600 to-red-800',
      green: 'bg-gradient-to-r from-green-600 to-green-800',
      orange: 'bg-gradient-to-r from-orange-600 to-orange-800',
      purple: 'bg-gradient-to-r from-purple-600 to-purple-800'
    };

    preview.className = `bulletin-preview ${colorClasses[color]}`;
    preview.querySelector('.bulletin-content-preview').innerHTML = `<strong>${title}</strong> ${message}`;
    preview.querySelector('.bulletin-content-preview').style.animationDuration = `${speed}s`;
  }

  [titleInput, messageInput, speedInput, colorSelect].forEach(input => {
    input.addEventListener('input', updateBulletinPreview);
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    await saveBulletinSettings();
  });

  resetBtn.addEventListener('click', () => resetBulletinForm());

  updateBulletinPreview();
}

// Carousel management functionality
function setupCarouselManagement() {
  const addSlideBtn = document.getElementById('add-slide-btn');
  const modal = document.getElementById('slide-modal');
  const closeModalBtn = document.getElementById('close-modal');
  const cancelBtn = document.getElementById('cancel-btn');
  const slideForm = document.getElementById('slide-form');
  const imageUpload = document.getElementById('image-upload');
  const imageInput = document.getElementById('slide-image');

  // Modal controls
  addSlideBtn.addEventListener('click', () => openSlideModal());
  closeModalBtn.addEventListener('click', closeSlideModal);
  cancelBtn.addEventListener('click', closeSlideModal);
  
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeSlideModal();
  });

  // Image upload
  imageUpload.addEventListener('click', () => imageInput.click());
  imageUpload.addEventListener('dragover', handleDragOver);
  imageUpload.addEventListener('drop', handleDrop);
  imageInput.addEventListener('change', handleImageSelect);

  // Form submission
  slideForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    await saveSlide();
  });

  function openSlideModal(slide = null) {
    editingSlideId = slide ? slide.id : null;
    const modalTitle = document.getElementById('modal-title');
    
    if (slide) {
      modalTitle.textContent = 'Edit Slide';
      populateSlideForm(slide);
    } else {
      modalTitle.textContent = 'Add New Slide';
      slideForm.reset();
      resetImageUpload();
      document.getElementById('slide-order').value = slides.length + 1;
    }
    
    modal.classList.remove('hidden');
    document.body.classList.add('overflow-hidden');
  }

  function closeSlideModal() {
    modal.classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
    editingSlideId = null;
    slideForm.reset();
    resetImageUpload();
  }

  function handleDragOver(e) {
    e.preventDefault();
    e.currentTarget.classList.add('dragover');
  }

  function handleDrop(e) {
    e.preventDefault();
    e.currentTarget.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleImageFile(files[0]);
    }
  }

  function handleImageSelect(e) {
    const file = e.target.files[0];
    if (file) {
      handleImageFile(file);
    }
  }

  function handleImageFile(file) {
    if (file.size > 10 * 1024 * 1024) { // Updated to 10MB
      showStatus('File size must be less than 10MB', 'error');
      return;
    }

    if (!file.type.startsWith('image/')) {
      showStatus('Please select an image file', 'error');
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const preview = document.getElementById('image-preview');
      const placeholder = document.getElementById('upload-placeholder');
      const previewImg = document.getElementById('preview-img');
      const imageName = document.getElementById('image-name');

      previewImg.src = e.target.result;
      imageName.textContent = file.name;
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  }

  function resetImageUpload() {
    const preview = document.getElementById('image-preview');
    const placeholder = document.getElementById('upload-placeholder');
    
    preview.classList.add('hidden');
    placeholder.classList.remove('hidden');
    imageInput.value = '';
  }

  function populateSlideForm(slide) {
    document.getElementById('slide-id').value = slide.id;
    document.getElementById('slide-title').value = slide.title;
    document.getElementById('slide-description').value = slide.description;
    document.getElementById('slide-order').value = slide.order;
    document.getElementById('slide-active').checked = slide.active;

    if (slide.image && slide.image !== '/images/placeholder.jpg') {
      const preview = document.getElementById('image-preview');
      const placeholder = document.getElementById('upload-placeholder');
      const previewImg = document.getElementById('preview-img');
      const imageName = document.getElementById('image-name');

      previewImg.src = slide.image;
      imageName.textContent = 'Current Image';
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
    }
  }

  // Expose openSlideModal for external use
  window.openSlideModal = openSlideModal;
}

// Load initial data
async function loadInitialData() {
  try {
    const bulletinResponse = await fetch('/admin/api/bulletins');
    if (bulletinResponse.ok) {
      const bulletinData = await bulletinResponse.json();
      bulletins = bulletinData.bulletins || [];
      renderBulletinList();
      if (bulletins.length) {
        populateBulletinForm(bulletins[0]);
      }
    }

    // Load carousel slides
    const carouselResponse = await fetch('/admin/api/carousel');
    if (carouselResponse.ok) {
      const carouselData = await carouselResponse.json();
      slides = carouselData.slides || [];
      renderSlides();
    }
  } catch (error) {
    console.error('Error loading initial data:', error);
    showStatus('Error loading data', 'error');
  }
}

function populateBulletinForm(bulletin) {
  if (!bulletin) return;
  editingBulletinId = bulletin._id || null;
  document.getElementById('bulletinId').value = editingBulletinId || '';
  document.getElementById('bulletinEnabled').checked = Boolean(bulletin.enabled);
  document.getElementById('bulletinTitle').value = bulletin.title || 'Latest News :';
  document.getElementById('bulletinMessage').value = bulletin.message || '';
  document.getElementById('bulletinLink').value = bulletin.linkUrl || '';
  document.getElementById('bulletinSpeed').value = bulletin.speed || 15;
  document.getElementById('bulletinColor').value = bulletin.color || 'blue';
  document.getElementById('bulletinPriority').value = bulletin.priority || 'normal';
  document.getElementById('bulletin-form').querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save mr-2"></i> Update Bulletin';
  const titleInput = document.getElementById('bulletinTitle');
  if (titleInput) {
    titleInput.dispatchEvent(new Event('input'));
  }
}

function resetBulletinForm() {
  editingBulletinId = null;
  document.getElementById('bulletinId').value = '';
  document.getElementById('bulletinEnabled').checked = true;
  document.getElementById('bulletinTitle').value = 'Latest News :';
  document.getElementById('bulletinMessage').value = '';
  document.getElementById('bulletinLink').value = '';
  document.getElementById('bulletinSpeed').value = 15;
  document.getElementById('bulletinColor').value = 'blue';
  document.getElementById('bulletinPriority').value = 'normal';
  document.getElementById('bulletin-form').querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save mr-2"></i> Save Bulletin';
  const titleInput = document.getElementById('bulletinTitle');
  if (titleInput) titleInput.dispatchEvent(new Event('input'));
}

// Save bulletin settings
async function saveBulletinSettings() {
  try {
    const formData = new FormData(document.getElementById('bulletin-form'));
    const bulletinPayload = {
      enabled: document.getElementById('bulletinEnabled').checked,
      title: formData.get('title'),
      message: formData.get('message'),
      speed: parseInt(formData.get('speed')),
      color: formData.get('color'),
      priority: formData.get('priority'),
      linkUrl: formData.get('linkUrl')
    };

    const method = editingBulletinId ? 'PUT' : 'POST';
    const url = editingBulletinId ? `/admin/api/bulletins/${editingBulletinId}` : '/admin/api/bulletins';

    const response = await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(bulletinPayload)
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to save bulletin');
    }

    showStatus(editingBulletinId ? 'Bulletin updated successfully!' : 'Bulletin created successfully!', 'success');
    await reloadBulletins();
    resetBulletinForm();
  } catch (error) {
    console.error('Error saving bulletin:', error);
    showStatus(`Error saving bulletin: ${error.message}`, 'error');
  }
}

async function reloadBulletins() {
  const res = await fetch('/admin/api/bulletins');
  if (res.ok) {
    const data = await res.json();
    bulletins = data.bulletins || [];
    renderBulletinList();
  }
}

function renderBulletinList() {
  const container = document.getElementById('bulletinList');
  const countEl = document.getElementById('bulletinCount');
  if (!container) return;
  if (!bulletins.length) {
    container.innerHTML = '<div class="text-gray-500 text-sm">No bulletins yet.</div>';
    if (countEl) countEl.textContent = '0 items';
    return;
  }
  container.innerHTML = bulletins.map((b) => `
    <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-start bg-gray-50">
      <div>
        <div class="flex items-center gap-2">
          <span class="font-semibold text-gray-800">${b.title || 'Latest News :'}</span>
          <span class="text-xs px-2 py-1 rounded-full ${b.enabled ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">
            ${b.enabled ? 'Visible' : 'Hidden'}
          </span>
          <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700 capitalize">${b.priority || 'normal'}</span>
        </div>
        <p class="text-gray-700 mt-1">${b.message || ''}</p>
        ${b.linkUrl ? `<a href="${b.linkUrl}" target="_blank" class="text-blue-600 text-sm underline break-words">Link</a>` : ''}
        <p class="text-xs text-gray-500 mt-1">Speed: ${b.speed || 15}s â€¢ Color: ${b.color || 'blue'}</p>
      </div>
      <div class="space-x-2">
        <button class="text-blue-600 hover:underline text-sm" onclick="editBulletin('${b._id}')">Edit</button>
        <button class="text-red-600 hover:underline text-sm" onclick="deleteBulletin('${b._id}')">Delete</button>
      </div>
    </div>
  `).join('');
  if (countEl) countEl.textContent = `${bulletins.length} item${bulletins.length === 1 ? '' : 's'}`;
}

function editBulletin(id) {
  const bulletin = bulletins.find((b) => b._id === id);
  if (!bulletin) return;
  populateBulletinForm(bulletin);
  document.querySelector('#bulletin-form').scrollIntoView({ behavior: 'smooth' });
}

async function deleteBulletin(id) {
  if (!confirm('Delete this bulletin?')) return;
  try {
    const res = await fetch(`/admin/api/bulletins/${id}`, { method: 'DELETE' });
    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.message || 'Failed to delete bulletin');
    }
    showStatus('Bulletin deleted', 'success');
    await reloadBulletins();
    if (editingBulletinId === id) resetBulletinForm();
  } catch (error) {
    console.error(error);
    showStatus(error.message, 'error');
  }
}

// Render carousel slides
function renderSlides() {
  const container = document.getElementById('slides-container');
  
  if (slides.length === 0) {
    container.innerHTML = `
      <div class="text-center py-8 text-gray-500">
        <i class="fas fa-images text-4xl mb-4"></i>
        <p>No slides added yet. Click "Add New Slide" to get started.</p>
      </div>
    `;
    return;
  }

  // Sort slides by order
  const sortedSlides = [...slides].sort((a, b) => a.order - b.order);

  container.innerHTML = sortedSlides.map(slide => `
    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
      <div class="flex items-start space-x-4">
        <div class="flex-shrink-0">
          <img src="${slide.image || '/images/placeholder.jpg'}" alt="${slide.title}" 
            class="w-20 h-20 object-cover rounded-lg" onerror="this.src='/images/placeholder.jpg'">
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="text-lg font-medium text-gray-900 truncate">${slide.title}</h3>
              <p class="text-sm text-gray-600 mt-1">${slide.description}</p>
              <div class="flex items-center mt-2 space-x-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${slide.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                  ${slide.active ? 'Active' : 'Inactive'}
                </span>
                <span class="text-xs text-gray-500">Order: ${slide.order}</span>
              </div>
            </div>
            <div class="flex items-center space-x-2 ml-4">
              <button onclick="editSlide('${slide.id}')" 
                class="text-blue-600 hover:text-blue-800 p-2 rounded-md hover:bg-blue-50">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="deleteSlide('${slide.id}')" 
                class="text-red-600 hover:text-red-800 p-2 rounded-md hover:bg-red-50">
                <i class="fas fa-trash"></i>
              </button>
              <div class="flex flex-col space-y-1">
                <button onclick="moveSlide('${slide.id}', 'up')" 
                  class="text-gray-600 hover:text-gray-800 p-1 rounded hover:bg-gray-100" 
                  ${slide.order === 1 ? 'disabled' : ''}>
                  <i class="fas fa-chevron-up text-xs"></i>
                </button>
                <button onclick="moveSlide('${slide.id}', 'down')" 
                  class="text-gray-600 hover:text-gray-800 p-1 rounded hover:bg-gray-100"
                  ${slide.order === slides.length ? 'disabled' : ''}>
                  <i class="fas fa-chevron-down text-xs"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

// Save slide - Updated to use FormData for file uploads
async function saveSlide() {
  try {
    const form = document.getElementById('slide-form');
    const formData = new FormData();
    
    // Add text fields
    formData.append('id', editingSlideId || generateId());
    formData.append('title', form.title.value);
    formData.append('description', form.description.value);
    formData.append('order', parseInt(form.order.value));
    formData.append('active', document.getElementById('slide-active').checked);

    // Handle image
    const imageFile = document.getElementById('slide-image').files[0];
    if (imageFile) {
      // File upload
      formData.append('imageFile', imageFile);
    } else if (!editingSlideId) {
      // New slide without image - check if there's a preview (base64)
      const previewImg = document.getElementById('preview-img');
      if (previewImg.src && previewImg.src.startsWith('data:')) {
        formData.append('imageBase64', previewImg.src);
      }
    }

    const response = await fetch('/admin/api/carousel/slides', {
      method: editingSlideId ? 'PUT' : 'POST',
      body: formData // Don't set Content-Type header, let browser set it for multipart/form-data
    });

    if (response.ok) {
      const result = await response.json();
      
      if (editingSlideId) {
        const index = slides.findIndex(s => s.id === editingSlideId);
        if (index !== -1) {
          slides[index] = result.slide;
        }
      } else {
        slides.push(result.slide);
      }

      renderSlides();
      closeSlideModal();
      showStatus(editingSlideId ? 'Slide updated successfully!' : 'Slide added successfully!', 'success');
    } else {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to save slide');
    }
  } catch (error) {
    console.error('Error saving slide:', error);
    showStatus(`Error saving slide: ${error.message}`, 'error');
  }
}

// Edit slide
window.editSlide = function(slideId) {
  const slide = slides.find(s => s.id === slideId);
  if (slide) {
    window.openSlideModal(slide);
  }
};

// Delete slide
window.deleteSlide = async function(slideId) {
  if (!confirm('Are you sure you want to delete this slide?')) {
    return;
  }

  try {
    const response = await fetch(`/admin/api/carousel/slides/${slideId}`, {
      method: 'DELETE'
    });

    if (response.ok) {
      slides = slides.filter(s => s.id !== slideId);
      renderSlides();
      showStatus('Slide deleted successfully!', 'success');
    } else {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to delete slide');
    }
  } catch (error) {
    console.error('Error deleting slide:', error);
    showStatus(`Error deleting slide: ${error.message}`, 'error');
  }
};

// Move slide
window.moveSlide = async function(slideId, direction) {
  const slide = slides.find(s => s.id === slideId);
  if (!slide) return;

  const newOrder = direction === 'up' ? slide.order - 1 : slide.order + 1;
  if (newOrder < 1 || newOrder > slides.length) return;

  try {
    const response = await fetch(`/admin/api/carousel/slides/${slideId}/move`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ direction })
    });

    if (response.ok) {
      // Update local slides array
      const otherSlide = slides.find(s => s.order === newOrder);
      if (otherSlide) {
        otherSlide.order = slide.order;
      }
      slide.order = newOrder;

      renderSlides();
      showStatus('Slide order updated!', 'success');
    } else {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to move slide');
    }
  } catch (error) {
    console.error('Error moving slide:', error);
    showStatus(`Error moving slide: ${error.message}`, 'error');
  }
};

// Utility functions
function generateId() {
  return 'slide_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function showStatus(message, type) {
  const statusDiv = document.getElementById('status-message');
  
  const typeClasses = {
    success: 'bg-green-500 text-white',
    error: 'bg-red-500 text-white',
    info: 'bg-blue-500 text-white'
  };

  statusDiv.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 ${typeClasses[type] || typeClasses.info}`;
  statusDiv.textContent = message;
  statusDiv.classList.remove('hidden');

  setTimeout(() => {
    statusDiv.classList.add('hidden');
  }, 5000); // Increased to 5 seconds for better readability
}

function closeSlideModal() {
  const modal = document.getElementById('slide-modal');
  modal.classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
  editingSlideId = null;
  document.getElementById('slide-form').reset();
  
  const preview = document.getElementById('image-preview');
  const placeholder = document.getElementById('upload-placeholder');
  preview.classList.add('hidden');
  placeholder.classList.remove('hidden');
  document.getElementById('slide-image').value = '';
}
  </script>
</body>

</html>
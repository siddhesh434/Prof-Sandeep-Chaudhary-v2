<aside id="sidebar"
  class="w-72 bg-slate-900 text-slate-300 flex flex-col shadow-2xl transition-all duration-300 ease-in-out z-40 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 md:relative h-full overflow-hidden border-r border-slate-800">
  
  <!-- Sidebar Header -->
  <div class="p-3 flex items-center justify-between border-b border-slate-800 bg-slate-900 z-10 shrink-0">
    <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
            <i class="fas fa-layer-group"></i>
        </div>
        <span class="text-lg font-bold text-white tracking-tight">Admin123</span>
    </div>
    <!-- Close button for mobile -->
    <button id="close-sidebar" class="text-slate-400 hover:text-white md:hidden transition-colors">
      <i class="fas fa-times text-xl"></i>
    </button>
  </div>

  <!-- Search Bar -->
  <div class="px-4 py-4 bg-slate-900 z-10 shrink-0 border-b border-slate-800/50">
      <div class="relative group">
          <input type="text" id="sidebar-search" 
              class="w-full bg-slate-800 text-sm text-slate-200 rounded-lg pl-10 pr-4 py-2.5 border border-slate-700 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-500" 
              placeholder="Search menu...">
          <div class="absolute left-3 top-2.5 text-slate-500 group-focus-within:text-blue-500 transition-colors">
              <i class="fas fa-search"></i>
          </div>
      </div>
  </div>

  <!-- Sidebar Navigation -->
  <nav class="flex-1 overflow-y-auto min-h-0 px-3 py-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent">
    <ul class="space-y-1" id="sidebar-menu">
      <!-- Dashboard (no collapse) -->
      <li class="menu-item">
        <a href="/admin" 
          class="flex items-center py-2.5 px-3 rounded-lg font-medium text-sm transition-all duration-200 group <%= currentPage === '/admin' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' : 'hover:bg-slate-800 hover:text-white' %>">
          <i class="fas fa-chart-pie w-6 h-6 flex items-center justify-center mr-3 <%= currentPage === '/admin' ? 'text-white' : 'text-slate-400 group-hover:text-blue-400' %> transition-colors"></i>
          <span>Dashboard</span>
        </a>
      </li>

      <!-- Home Page Section -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="home">
          <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('home')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
              <i class="fas fa-home w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
              <span class="font-medium">Home Page</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
          </div>
          <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
              <a href="/admin/latest_news.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('latest_news') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Latest News
              </a>
            </li>
            <li>
              <a href="/admin/homeHighlights.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('homeHighlights') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Home Highlights
              </a>
            </li>
          </ul>
        </div>
      </li>

      <!-- Publications Section -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="publications">
          <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('publications')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
              <i class="fas fa-book w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
              <span class="font-medium">Publications</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
          </div>
          <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
              <a href="/admin/publication.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('publication.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Journals
              </a>
            </li>
            <li>
              <a href="/admin/conference.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('conference.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Conferences
              </a>
            </li>
            <li>
              <a href="/admin/book.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('book.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Books
              </a>
            </li>
            <li>
              <a href="/admin/chapters.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('chapters.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Book Chapters
              </a>
            </li>
          </ul>
        </div>
      </li>
      

      <!-- Projects Section -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="projects">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('projects')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-flask w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Projects</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/projects.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('projects.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Research Projects
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Patents -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="patents">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('patents')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-lightbulb w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Patents</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/patents.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('patents.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Patents List
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Research Group -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="research-group">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('research-group')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-users w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Team</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/researchMembers.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('researchMembers.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Team Members
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Supervised Work -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="supervised">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('supervised')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-user-graduate w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Supervision</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/dissertations.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('dissertations.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Dissertations
                </a>
            </li>
            </ul>
        </div>
      </li>
      

      <!-- Key Technologies -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="key-tech">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('key-tech')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-microchip w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Technologies</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/keyTechnology.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('keyTechnology.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Key Technologies
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Facilities -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="facilities">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('facilities')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-building w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Facilities</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/facilities.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('facilities.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Facilities
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Extension -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="extension">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('extension')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-hands-helping w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Extension</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/extension.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('extension.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Extension Activities
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- E-Resources -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="eresources">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('eresources')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-folder-open w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Resources</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/eResources.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('eResources.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                E-Resources
                </a>
            </li>
            </ul>
        </div>
      </li>

      <!-- Settings -->
      <li class="menu-item-group">
        <div class="nav-section group" data-section="settings">
            <div class="section-header flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-800 hover:text-white text-sm"
            onclick="toggleSection('settings')">
            <div class="flex items-center text-slate-300 group-hover:text-white">
                <i class="fas fa-cog w-6 h-6 flex items-center justify-center mr-3 text-slate-400 group-hover:text-blue-400 transition-colors"></i>
                <span class="font-medium">Settings</span>
            </div>
            <i class="fas fa-chevron-down toggle-icon text-xs text-slate-500 transition-transform duration-200"></i>
            </div>
            <ul class="section-items ml-9 mt-1 space-y-1 hidden border-l border-slate-700 pl-3">
            <li>
                <a href="/admin/control.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('control.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Visibility
                </a>
            </li>
            <li>
                <a href="/admin/cvGenerator.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('cvGenerator.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                CV Generator
                </a>
            </li>
            <li>
                <a href="/admin/files.html"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('files.html') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                File Manager
                </a>
            </li>
            <li>
                <a href="/admin/formData"
                class="block py-2 px-3 text-xs rounded-md transition-all duration-200 <%= currentPage.includes('formData') ? 'text-blue-400 font-medium' : 'text-slate-400 hover:text-white hover:translate-x-1' %>">
                Requests
                </a>
            </li>
            </ul>
        </div>
      </li>
      
    </ul>
  </nav>

  <!-- User Profile Section -->
  <div class="p-4 bg-slate-800 border-t border-slate-700 shrink-0">
      <div class="flex items-center justify-between">
          <div class="flex items-center">
              <div class="w-9 h-9 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold shadow-md">
                  A
              </div>
              <div class="ml-3">
                  <p class="text-xs font-medium text-white">Admin User</p>
              </div>
          </div>
          <a href="/admin/logout" class="text-slate-400 hover:text-white transition-colors" title="Logout">
              <i class="fas fa-sign-out-alt"></i>
          </a>
      </div>
  </div>
</aside>

<!-- Sidebar JavaScript -->
<script>
  // Toggle section expand/collapse - Must be global for onclick attributes
  window.toggleSection = function(sectionName) {
    const section = document.querySelector(`[data-section="${sectionName}"]`);
    if (!section) return;
    
    const items = section.querySelector('.section-items');
    const icon = section.querySelector('.toggle-icon');
    
    const isExpanded = !items.classList.contains('hidden');
    
    if (isExpanded) {
      items.classList.add('hidden');
      icon.style.transform = 'rotate(0deg)';
      section.classList.remove('expanded');
    } else {
      items.classList.remove('hidden');
      icon.style.transform = 'rotate(180deg)';
      section.classList.add('expanded');
    }
    
    saveExpandedState();
  }

  // Save expanded sections to localStorage
  function saveExpandedState() {
    const expanded = Array.from(document.querySelectorAll('.nav-section.expanded'))
      .map(el => el.dataset.section);
    localStorage.setItem('adminSidebarExpanded', JSON.stringify(expanded));
  }

  // Initialize sidebar functionality in an isolated scope to avoid conflicts
  (function() {
    // Restore expanded state on page load
    function restoreExpandedState() {
      const expanded = JSON.parse(localStorage.getItem('adminSidebarExpanded') || '[]');
      expanded.forEach(sectionName => {
        const section = document.querySelector(`[data-section="${sectionName}"]`);
        if (section) {
          const items = section.querySelector('.section-items');
          const icon = section.querySelector('.toggle-icon');
          if (items && icon) {
            items.classList.remove('hidden');
            icon.style.transform = 'rotate(180deg)';
            section.classList.add('expanded');
          }
        }
      });
    }

    // Auto-expand section containing active page
    function expandActiveSection() {
      const activePage = window.location.pathname;
      // Also check specific files if path is cleaner
      const selectors = [
          `a[href="${activePage}"]`,
          // Add flexible matching for nested paths if needed
      ];
      
      let activeLink = document.querySelector(`a[href="${activePage}"]`);
      
      if (activeLink) {
        // Highlight logic controlled by EJS rendering mostly, but we ensure it expands
        const section = activeLink.closest('.nav-section');
        if (section) {
          const items = section.querySelector('.section-items');
          const icon = section.querySelector('.toggle-icon');
          if (items && icon) {
            items.classList.remove('hidden');
            icon.style.transform = 'rotate(180deg)';
            section.classList.add('expanded');
          }
        }
      }
    }
    // Search functionality
    function initSearch() {
        const searchInput = document.getElementById('sidebar-search');
        if(!searchInput) return;
        
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            const groups = document.querySelectorAll('.menu-item-group');
            const simpleItems = document.querySelectorAll('.menu-item');
            const headers = document.querySelectorAll('.menu-header');

            if(term === '') {
                // Reset
                groups.forEach(g => g.classList.remove('hidden'));
                simpleItems.forEach(i => i.classList.remove('hidden'));
                headers.forEach(h => h.classList.remove('hidden'));
                return;
            }

            // Hide headers during search
            headers.forEach(h => h.classList.add('hidden'));

            simpleItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if(text.includes(term)) item.classList.remove('hidden');
                else item.classList.add('hidden');
            });

            groups.forEach(group => {
                const headerText = group.querySelector('.section-header').textContent.toLowerCase();
                const items = group.querySelectorAll('.section-items li');
                let hasMatch = headerText.includes(term);
                
                // Check sub items
                items.forEach(li => {
                    if(li.textContent.toLowerCase().includes(term)) {
                        hasMatch = true;
                        // Force show parent if child matches
                        group.querySelector('.section-items').classList.remove('hidden');
                    }
                });

                if(hasMatch) group.classList.remove('hidden');
                else group.classList.add('hidden');
            });
        });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      restoreExpandedState();
      expandActiveSection();
      initSearch();
    });

    // Mobile sidebar toggle logic from sidebar component
    const sbCloseBtn = document.getElementById("close-sidebar");
    const sbSidebar = document.getElementById("sidebar");
    const sbOverlay = document.getElementById("sidebar-overlay");

    if (sbCloseBtn) {
      sbCloseBtn.addEventListener("click", function() {
        sbSidebar.classList.add("-translate-x-full");
        if (sbOverlay) sbOverlay.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
      });
    }
  })();
</script>
